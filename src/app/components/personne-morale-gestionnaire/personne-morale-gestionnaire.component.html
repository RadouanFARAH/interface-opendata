<mat-tab-group class="one" (selectedTabChange)="makeItFocused($event)" color="warn">
    <!-- Personne Physique  -->

    <mat-tab label="nouvelles demandes">

        <!-- Filter by statut-->
        <mat-form-field class="filter" appearance="fill">
            <mat-label>selectionner la source</mat-label>
            <mat-select [(ngModel)]="sourceSelectedValue" (selectionChange)="sourceChanged()">
                <mat-option *ngFor="let statut of source" [value]="statut.value">
                    {{ statut.viewValue }}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <mat-form-field *ngIf="sourceSelectedValue === 'prequalifier' " class="filter" appearance="fill">
            <mat-label>Filtrer par statut traitement</mat-label>
            <mat-select [(ngModel)]="statutSelectedValue" (selectionChange)="onChangeStatut()">
                <mat-option *ngFor="let statut of statusTraitement" [value]="statut.statutC">
                    {{ statut.statut }}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <mat-form-field *ngIf="sourceSelectedValue === 'evolan' "  class="filter" appearance="fill">
            <mat-label>Filtrer par statut</mat-label>
            <mat-select [(ngModel)]="selectedValue" (selectionChange)="onChange()">
                <mat-option *ngFor="let statut of status" [value]="statut.value">
                    {{ statut.viewValue }}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <ngb-alert *ngIf="isAlert" type="danger">{{ alert }}</ngb-alert>
        <!--  Table-->
        <mat-spinner style="margin: 0 auto;"  *ngIf="!dataSource && isSourceSelected"></mat-spinner>

        <div *ngIf="dataSource">
            <div style="margin: 40px auto;
            display: table;">
                <button style="margin-left: 10px;"  mat-raised-button (click)="exporter.exportTable('xlsx',{fileName:'demandes_data'})">Excel</button>
                <button style="margin-left: 10px;"  mat-raised-button (click)="exporter.exportTable('csv',{fileName:'demandes_data'})">CSV</button>
                <button style="margin-left: 10px;"  mat-raised-button (click)="exporter.exportTable('json',{fileName:'demandes_data'})">JSON</button>
                <button style="margin-left: 10px;"  mat-raised-button (click)="exporter.exportTable('txt',{fileName:'demandes_data'})">TEXT</button>
            </div>
            <table mat-table  [dataSource]="dataSource" matTableExporter #exporter="matTableExporter" class="mat-elevation-z8" matSort>

                <ng-container matColumnDef="nom">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Nom</th>
                    <td mat-cell *matCellDef="let element">{{ element.nom }}</td>
                </ng-container>
    
                <ng-container matColumnDef="prenom">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Prenom</th>
                    <td mat-cell *matCellDef="let element">{{ element.prenom }}</td>
                </ng-container>
                <ng-container matColumnDef="cin">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>CIN</th>
                    <td mat-cell *matCellDef="let element">{{ element.cin }}</td>
                </ng-container>
                <ng-container matColumnDef="telgsm">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Tel</th>
                    <td mat-cell *matCellDef="let element">{{ element.telgsm }}</td>
                </ng-container>
                <ng-container matColumnDef="resultatTraitement">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Resultat Traitement</th>
                    <td mat-cell *matCellDef="let element">{{ element.resultatTraitement === 'nouvelle' ? '':element.resultatTraitement}}</td>
                </ng-container>
                <ng-container matColumnDef="statuttraitement">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Statut de demande</th>
                    <td mat-cell *matCellDef="let element">{{ element.statuttraitement }}</td>
                </ng-container>
                <ng-container matColumnDef="montantdemande">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Montant demandé</th>
                    <td mat-cell *matCellDef="let element">{{ element.montantdemande }}</td>
                </ng-container>
                <ng-container matColumnDef="secteur">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Secteur</th>
                    <td mat-cell *matCellDef="let element">{{ element.secteur }}</td>
                </ng-container>
                <!-- <ng-container matColumnDef="projet">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Projet</th>
                    <td mat-cell *matCellDef="let element">{{ element.projet }}</td>
                </ng-container> -->
                <ng-container matColumnDef="email">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Email</th>
                    <td mat-cell *matCellDef="let element">{{ element.email }}</td>
                </ng-container>
                <ng-container matColumnDef="ville">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Ville</th>
                    <td mat-cell *matCellDef="let element">{{ element.ville }}</td>
                </ng-container>
                <ng-container matColumnDef="agence">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Agence</th>
                    <td mat-cell *matCellDef="let element">{{ element.agence }}</td>
                </ng-container>
                <ng-container matColumnDef="codeagence">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Code Agence</th>
                    <td mat-cell *matCellDef="let element">{{ element.codeagence }}</td>
                </ng-container>
                <ng-container matColumnDef="entry_date">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Date Entrée</th>
                    <td mat-cell *matCellDef="let element">{{ element.entry_date | date:'dd/mm/yyyy'}}</td>
                </ng-container>
                <ng-container matColumnDef="nbrappel">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Nombre Appel</th>
                    <td mat-cell *matCellDef="let element">{{ element.nbrappel }}</td>
                </ng-container>
                <ng-container matColumnDef="valeurid">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Valeur ID</th>
                    <td mat-cell *matCellDef="let element">{{ element.valeurid }}</td>
                </ng-container>
                <!-- <ng-container matColumnDef="id_od">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Id OD</th>
                    <td mat-cell *matCellDef="let element">{{ element.id_od }}</td>
                </ng-container> -->
                <ng-container matColumnDef="options">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>options</th>
                    <td mat-cell *matCellDef="let element">
                        <!-- <button (click)="openDialog(element.valeurid)" class="btn" mat-raised-button color="warn">
                            Set Agence 
                        </button>
                        <button (click)="openDialogSecond(element.valeurid)" class="btn" mat-raised-button color="warn">
                            Set Agent
                        </button>
                        <button (click)="getStatut(element.numtiers, element.codegestionnaire)" class="btn" mat-raised-button color="warn">
                            Get Statut
                        </button>
                        <button (click)="sendToEvolan(element)" class="btn" mat-raised-button color="warn">
                            Send To Evolan
                        </button> -->
                        <button (click)="send(element)" class="btn" mat-raised-button color="warn">
                            Details
                        </button>
                    </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
        </div>
        <mat-paginator [pageSizeOptions]="pageSizeOptions" showFirstLastButtons></mat-paginator>
        
    </mat-tab>
</mat-tab-group>